=== Map Microservice

Il microservizio, organizzato in architettura esagonale, definisce tre porte per interfacciarsi al layer di applicazione.

==== Application Layer

===== EBikeRepository

La porta è responsabile della gestione dei dati delle e-bike all'interno del sistema.

Fornisce metodi per salvare, recuperare e gestire le e-bike e i loro assegnamenti agli utenti. Ad esempio, consente di salvare una nuova e-bike nel repository, recuperare un'e-bike per nome e assegnare o de-assegnare e-bike agli utenti.

Inoltre, può recuperare un elenco di e-bike disponibili, verificare se una specifica e-bike è assegnata a un utente e recuperare tutte le e-bike o quelle assegnate a uno specifico utente.

Questa porta assicura che il sistema possa gestire in modo efficiente i dati delle e-bike e gli assegnamenti degli utenti.


===== EventPublisher

La porta è progettata per gestire la pubblicazione di eventi relativi alle e-bike e alle attività degli utenti.

Include metodi per pubblicare aggiornamenti su tutte le e-bike, aggiornamenti sulle e-bike assegnate a specifici utenti e aggiornamenti sulle e-bike disponibili per gli utenti.

Dispone anche di un metodo per pubblicare un evento quando un utente interrompe una corsa. Questa porta è fondamentale per mantenere il sistema e gli utenti informati sullo stato attuale delle e-bike e delle attività degli utenti, garantendo aggiornamenti e notifiche in tempo reale.

===== RestMapServiceAPI

La porta definisce il contratto per l'API REST che interagisce con il sistema delle e-bike. 

Include metodi per aggiornare le e-bike, notificare il sistema riguardo agli eventi di corsa e recuperare i dati delle e-bike.

Ad esempio, consente di aggiornare una singola e-bike o più e-bike, notificare il sistema quando un utente inizia o interrompe una corsa, e recuperare tutte le e-bike o quelle assegnate a uno specifico utente.

Questa interfaccia facilita la comunicazione tra il sistema delle e-bike e i client esterni, consentendo un'interazione fluida e uno scambio di dati.

==== Infrastructure Layer

Le tre porte sono quindi implementate nel layer infrastrutturale, che fornisce le implementazioni concrete per interagire con la repository, pubblicare eventi e gestire le richieste REST.

`BikeUpdateAdapter` e `RideUpdateAdapter` servono per ricevere aggiornamenti dai servizi di Bike e Ride, non passando per il gateway, ma sfruttando quindi la rete docker a cui tutti i servizi sono connessi.

`MapServiceVerticle` è invece il punto di ingresso del microservizio per l'utente, esso infatti è registrato al service-discovery e fornisce le due websocket per osservare i cambiamenti delle biciclette sulla mappa.

Come gli altri microservizi, utilizza la classe MetricsManager per trasmettere a Prometheus le metriche di sistema.